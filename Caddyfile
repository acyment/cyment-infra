# Postiz service (uses port 5000 as single entry point)
postiz.cyment.com {
    reverse_proxy postiz:5000
    encode gzip
}



timer.cyment.com {
    encode gzip
    reverse_proxy tempi-app:80
}


# CrowdTimer Zoom app + PocketBase proxy (public HTTPS)
zoom.crowdtimer.app {
    encode gzip

    # Minimal edge headers (Express/helmet sets CSP)
    header {
        X-Content-Type-Options "nosniff"
        Referrer-Policy "no-referrer"
    }

    # Proxy PocketBase under /pb (strip the prefix)
    handle_path /pb/* {
        reverse_proxy pocketbase:80 {
            header_up Host {host}
            header_up X-Real-IP {http.request.header.CF-Connecting-IP}
            header_up X-Forwarded-For {http.request.header.CF-Connecting-IP}
            header_up X-Forwarded-Proto {http.request.header.X-Forwarded-Proto}
        }
    }

    handle {
        reverse_proxy crowdtimer-app:3000 {
            header_up Host {host}
            header_up X-Real-IP {http.request.header.CF-Connecting-IP}
            header_up X-Forwarded-For {http.request.header.CF-Connecting-IP}
            header_up X-Forwarded-Proto {http.request.header.X-Forwarded-Proto}
        }
    }
}

# Remove wildcard - causes SSL issues without DNS challenge
